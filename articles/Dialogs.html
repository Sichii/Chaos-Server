<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Dialogs | Chaos Server Docs </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Dialogs | Chaos Server Docs ">
      
      <link rel="icon" href="../images/chaos.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Sichii/Chaos-Server/blob/release/v1.9/docs/articles/Dialogs.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/chaosico.png" alt="Chaos Server Docs">
            Chaos Server Docs
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="dialogs">Dialogs</h1>

<p>Dialogs in Chaos are both templated and scripted objects. When you define a dialog, you are defining a template that
will be used to create new instances of that dialog as requested. Each dialog that is displays is a fresh instance of
that dialog created from it's template.</p>
<h2 id="dialog-templates">Dialog Templates</h2>
<p>A dialog template is used to create new instances of dialogs as required. Any action that brings up a new dialog,
whether it be clicking an NPC, or clicking Next or Previous on an existing dialog, the next dialog shown will be a
fresh instance of a dialog created from a template.</p>
<h2 id="how-do-i-create-them">How do I create them?</h2>
<p>By default, dialog templates should be created in <code>Data\Configuration\Templates\Dialogs</code>. Configuration of how map
templates are loaded can be found in <code>appsettings.json</code> at <code>Options:DialogTemplateCacheOptions</code>.</p>
<p>Map templates are initially serialized into <a class="xref" href="../api/Chaos.Schemas.Templates.DialogTemplateSchema.html">DialogTemplateSchema</a>
before being mapped to a <a class="xref" href="../api/Chaos.Models.Templates.DialogTemplate.html">DialogTemplate</a>. The schema object is mapped via
the <a class="xref" href="../api/Chaos.Services.MapperProfiles.DialogMapperProfile.html">DialogMapperProfile</a>.</p>
<p>See <a class="xref" href="../api/Chaos.Schemas.Templates.DialogTemplateSchema.html">DialogTemplateSchema</a> for a list of all configurable
properties with descriptions.</p>
<h2 id="how-do-i-use-them">How do I use them?</h2>
<p>Dialogs can be created by using the <a class="xref" href="../api/Chaos.Services.Factories.DialogFactory.html">DialogFactory</a>, which is an
implementation of [IDialogFactory](&lt;xref:Chaos.Services.Factories.Abstractions.IDialogFactory).</p>
<div class="NOTE">
<h5>Note</h5>
<p>Each dialog is a fresh instance of a dialog created from a template. Any changes made to the template will apply to
all instances of that dialog.</p>
</div>
<pre><code class="lang-cs">private readonly IDialogFactory DialogFactory;

public Foo(IDialogFactory dialogFactory) =&gt; DialogFactory = dialogFactory;

public void Bar()
{
    //create a new dialog with dialogSource as the source of the dialog
    //dialogSource can be almost any object (items, monsters, merchants, aislings, etc)
    //extraScriptKeys is optional, and can be used to pass in extra script keys that are not part of the templated dialog
    var dialog = DialogFactory.Create(&quot;myDialogTemplateKey&quot;, dialogSource, extraScriptKeys);
}
</code></pre>
<h2 id="state-and-context">State and Context</h2>
<p>Dialogs can have context passed between them by setting the <code>Contextual</code> property of the dialog template to true. This
will cause any dialog leading to a contextual dialog to pass it's state to it. State is stored in 2
places, <code>Dialog.MenuArgs</code> and <code>Dialog.Context</code>.</p>
<div class="NOTE">
<h5>Note</h5>
<p>You can create chains of dialogs that share context by specifying <code>Contextual</code> on all dialogs in that chain except the
first one</p>
</div>
<div class="CAUTION">
<h5>Caution</h5>
<p>Do not specify <code>Contextual</code> on a dialog that is the first in a chain of dialogs that share context</p>
</div>
<h3 id="dialogmenuargs">Dialog.MenuArgs</h3>
<p>MenuArgs is an <a class="xref" href="../api/Chaos.Collections.Common.ArgumentCollection.html">ArgumentCollection</a>. This is used when specifying a
dialog type of MenuTextEntry, MenuTextEntryWithArgs, and DialogTextEntry. When the user types in input and clicks ok,
MenuArgs will be populated with what they typed in. The ArgumentCollection facilitates easier conversion of the input to
the desired type. For example, if you want the user to type in a number, ArgumentCollection can perform that conversion
for you.</p>
<div class="CAUTION">
<h5>Caution</h5>
<p>A dialog type 'WithArgs' can have only 1 argument passed into it from MenuArgs. If the dialog has a type 'TextEntry',
the client can only return a maximum of 2 arguments, one passed in and one user input, with the last one always being
the most recent input</p>
</div>
<h3 id="dialogcontext">Dialog.Context</h3>
<p>Context is just an object, otherwise known as a <code>Tag</code>. This is meant to be used as context for dialog scripts. The type
of object stored is up to the script, and any script receiving that context should know what that object is. This should
rarely be used, only in situations where there you need more than the 2 arguments <code>MenuArgs</code> can provide. When a
dialogs <code>Context</code> property is passed to the next dialog, it is deep cloned just in case there is a need to use that
specific snapshot of the context later on.</p>
<h2 id="special-arguments">Special Arguments</h2>
<p>There are a few special keywords that can be used in a few places for unique behavior.</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Context</th>
</tr>
</thead>
<tbody>
<tr>
<td>Close</td>
<td>Specify &quot;Close&quot; as the NextDialogKey or Option.DialogKey to close the dialog</td>
</tr>
<tr>
<td>Skip</td>
<td>Specify &quot;Skip&quot; as a dialog's text to fire the events for that dialog, but skip displaying it. This is useful for triggering actions on the &quot;Success&quot; part of a confirmation option selection</td>
</tr>
<tr>
<td>Top</td>
<td>Specify &quot;Top&quot; as the NextDialogKey or Option.DialogKey to go back to the initial menu of the object you are interacting with.<br>This is exactly like clicking the &quot;Top&quot; button in a menu</td>
</tr>
</tbody>
</table>
<h2 id="scripting">Scripting</h2>
<p>Dialogs are scripted via <a class="xref" href="../api/Chaos.Scripting.DialogScripts.Abstractions.IDialogScript.html">IDialogScript</a>.</p>
<ul>
<li>Inherit from <a class="xref" href="../api/Chaos.Scripting.DialogScripts.Abstractions.DialogScriptBase.html">DialogScriptBase</a> for a basic script
that requires no external configuration</li>
<li>Inherit
from <a class="xref" href="../api/Chaos.Scripting.DialogScripts.Abstractions.ConfigurableDialogScriptBase.html">ConfigurableDialogScriptBase</a>
for a script that requires external configuration via ScriptVars</li>
</ul>
<p>Specify any number of script keys in the <code>DialogTemplate.ScriptKeys</code> property, and those scripts will automatically be
attached to the <code>Dialog</code> when it is created.</p>
<p>If the script is configurable, you must also have an entry for that script in the <code>DialogTemplate.ScriptVars</code> property.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The key of a script is the name of the class without 'Script' at the end</p>
</div>
<p>Here are the events overridable in dialog scripts:</p>
<table>
<thead>
<tr>
<th>Event Name</th>
<th>Context</th>
</tr>
</thead>
<tbody>
<tr>
<td>OnDisplaying</td>
<td>Called when the dialog is about to be displayed, but has not yet been displayed. You can use this event to modify the dialog before it is displayed, such as injecting text parameters into the dialog's text</td>
</tr>
<tr>
<td>OnDisplayed</td>
<td>Called when the dialog has been displayed</td>
</tr>
<tr>
<td>OnNext</td>
<td>Called when the player responds to the dialog, whether by clicking Next, selecting an option, or making any kind of selection<br>If an option is clicked, the optionIndex will be the index of the option that was clicked<br>If a shop selection was clicked, the text of that option will be in the MenuArgs property of the dialog<br>If a selection was made from the player's inventory, spell book, or skill book, the Slot that was selected will be in the MenuArgs property of the dialog</td>
</tr>
<tr>
<td>OnPrevious</td>
<td>Called when the player clicks the Previous button on a Normal dialog</td>
</tr>
</tbody>
</table>
<p>See <a href="Scripting.html">Scripting</a> for more details on scripting in general</p>
<h2 id="example">Example</h2>
<p>Here is an example of a dialog template json for a dialog used to confirm a purchase from a shop. This dialog is
contextual, and has a script. The script injects those contextual parameters into the dialog's text. It gets it's
context from dialogs that come before it which collect the name of the item being bought, and how many of them.</p>
<pre><code class="lang-json">{
  &quot;contextual&quot;: true,
  &quot;options&quot;: [
    {
      &quot;dialogKey&quot;: &quot;generic_buyshop_accepted&quot;,
      &quot;optionText&quot;: &quot;Yes&quot;
    },
    {
      &quot;dialogKey&quot;: &quot;generic_buyshop_declined&quot;,
      &quot;optionText&quot;: &quot;No&quot;
    }
  ],
  &quot;scriptKeys&quot;: [
    &quot;buyshop&quot;
  ],
  &quot;scriptVars&quot;: {},
  &quot;templateKey&quot;: &quot;generic_buyshop_confirmation&quot;,
  &quot;text&quot;: &quot;You want to buy {Amount} {ItemName}s? That will be {Cost} gold, does that sound fair?&quot;,
  &quot;type&quot;: &quot;MenuWithArgs&quot;
}
</code></pre>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Sichii/Chaos-Server/blob/release/v1.9/docs/articles/Dialogs.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
